{{define "title"}}{{.server.Name}}{{end}}
{{define "page"}}server/{{.server.ID}}{{end}}

{{define "server_status.html"}}
<div class="server-content grid gap-6"
    data-page-title="Server {{.server.Name}}"
    data-server-id="{{.server.ID}}"
    data-server-name="{{.server.Name}}"
    data-server-running="{{if .server.Running}}true{{else}}false{{end}}"
    data-server-paused="{{if .server.Paused}}true{{else}}false{{end}}"
    data-server-starting="{{if .server.Starting}}true{{else}}false{{end}}"
    data-server-stopping="{{if .server.Stopping}}true{{else}}false{{end}}"
    data-server-storming="{{if .server.Storming}}true{{else}}false{{end}}"
    data-shutdown-delay="{{.server.ShutdownDelaySeconds}}"
    data-player-saves="{{if .server.PlayerSaves}}true{{else}}false{{end}}"
    data-player-save-excludes="{{range $index, $id := .server.PlayerSaveExcludes}}{{if $index}},{{end}}{{ $id }}{{end}}"
    {{if .banned_ids}}data-banned-ids="{{range $index, $id := .banned_ids}}{{if $index}},{{end}}{{ $id }}{{end}}"{{end}}
    {{if .server.ServerStarted}}data-server-started="{{.server.ServerStarted.Format "2006-01-02T15:04:05Z07:00"}}"{{end}}
    {{if .server.ServerSaved}}data-server-saved="{{.server.ServerSaved.Format "2006-01-02T15:04:05Z07:00"}}"{{end}}>

    {{/* Error Banner */}}
    <div id="server-error-banner" class="alert alert-danger {{if not .server.LastError}}hidden{{end}} col-span-full" role="alert">
        <div class="alert-icon">
            <i data-feather="alert-circle"></i>
        </div>
        <div class="alert-content">
            <h4 class="alert-title">Startup Error Detected</h4>
            <p id="server-error-text" class="alert-message">{{ .server.LastError }}</p>
            {{if .server.LastErrorAt}}
            <p class="alert-meta">Occurred at <span id="server-error-time">{{ .server.LastErrorAt.Format "Jan 2, 2006 3:04:05 PM" }}</span></p>
            {{end}}
        </div>
    </div>

    {{- $pageData := . -}}
    {{- $cardSlots := .cardSlots -}}
    {{- if not $cardSlots -}}
        {{- $cardSlots = dict -}}
    {{- end -}}
    {{- $cardIDs := .cardIDs -}}
    {{- if not $cardIDs -}}
        {{- $cardIDs = slice -}}
    {{- end -}}
    {{- $hasControlCard := and $cardIDs (has $cardIDs "server-status-control") -}}
    {{- $hasPlayersCard := and $cardIDs (has $cardIDs "server-status-players") -}}
    {{- $hasChatCard := and $cardIDs (has $cardIDs "server-status-chat") -}}
    {{- $hasSavesCard := and $cardIDs (has $cardIDs "server-status-saves") -}}
    {{- $hasConfigCard := and $cardIDs (has $cardIDs "server-status-config") -}}
    {{- $hasDiscordCard := and $cardIDs (has $cardIDs "server-status-discord") -}}
    {{- $hasLogsCard := and $cardIDs (has $cardIDs "server-status-logs") -}}

    {{- $primaryCards := index $cardSlots "primary" -}}
    {{- if $primaryCards -}}
        {{- range $primaryCards -}}
            {{- renderCard .Template .Data -}}
        {{- end -}}
    {{- else -}}
        {{template "cards/server_status_info.html" $pageData}}
    {{- end -}}

    {{- $gridCards := index $cardSlots "grid" -}}
    <div class="server-card-grid server-card-grid-halves" data-slot="grid">
        {{- if $gridCards -}}
            {{- range $gridCards -}}
                {{- renderCard .Template .Data -}}
            {{- end -}}
        {{- end -}}

        {{- if not $hasControlCard -}}
            {{template "cards/server_status_control.html" $pageData}}
        {{- end -}}
        {{- if not $hasPlayersCard -}}
            {{template "cards/server_status_players.html" $pageData}}
        {{- end -}}
        {{- if not $hasChatCard -}}
            {{template "cards/server_status_chat.html" $pageData}}
        {{- end -}}
        {{- if not $hasSavesCard -}}
            {{template "cards/server_status_saves.html" $pageData}}
        {{- end -}}
        {{- if not $hasConfigCard -}}
            {{template "cards/server_status_config.html" $pageData}}
        {{- end -}}
        {{- if not $hasDiscordCard -}}
            {{template "cards/server_status_discord.html" $pageData}}
        {{- end -}}
    </div>

    {{- $footerCards := index $cardSlots "footer" -}}
    {{- if $footerCards -}}
        <div class="server-card-footer" data-slot="footer">
            {{- range $footerCards -}}
                {{- renderCard .Template .Data -}}
            {{- end -}}
        </div>
    {{- end -}}
    {{- if not $hasLogsCard -}}
        {{template "cards/server_status_logs.html" $pageData}}
    {{- end -}}
</div>

<script src="/static/js/screens/server_status.js" defer></script>
{{end}}
