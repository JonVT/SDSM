{{define "cards/dashboard_manager.html"}}
{{$port := .port_label}}
{{if not $port}}{{$port = "â€”"}}{{end}}
{{$portValue := .port}}
{{$root := .root_label}}
{{if not $root}}{{$root = "Not configured"}}{{end}}
{{$rootValue := .root_path}}
{{$pillClass := .pill_class}}
{{if not $pillClass}}{{$pillClass = "is-warning"}}{{end}}
{{$statusLabel := .status_label}}
{{if not $statusLabel}}{{$statusLabel = "Status Unknown"}}{{end}}
{{$statusMeta := .status_meta}}
{{$metaHidden := .status_meta_hidden}}
{{$serversActive := .servers_active}}
{{$serversTotal := .servers_total}}
{{$componentsHealthy := .components_uptodate}}
{{$componentsTotal := .components_total}}
{{$componentsOutdated := .components_outdated}}
{{$playersConnected := .players_connected}}
{{$timestamp := .timestamp}}
{{$timestampISO := .timestamp_iso}}
<div id="dashboard-card-manager"
    class="card manager-card"
    role="link"
    tabindex="0"
    aria-label="Open Manager screen"
    data-card-id="dashboard-manager"
    data-card-navigate="/manager"
    data-card-assets='["/static/js/cards/dashboard_manager.js"]'
    data-manager-card
    hx-get="/dashboard/cards/dashboard-manager"
    hx-trigger="sdsm:card-refresh[event.detail.cardId == 'dashboard-manager'] from:body"
    hx-target="this"
    hx-swap="outerHTML">
    <div class="card-header manager-card-header">
        <div class="manager-header-primary">
            <div class="manager-title-row">
                <h2 class="card-title">Manager</h2>
                <span class="card-nav-indicator" aria-hidden="true">
                    <span class="card-nav-label">Tap to open</span>
                    <svg class="card-nav-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3l6 18 3-7 7 3L3 3z"/><path d="M13 13l6-6"/></svg>
                </span>
            </div>
            <div class="manager-last-sync text-xs text-tertiary">
                <span>Last synced</span>
                {{with $timestamp}}
                    <time datetime="{{$timestampISO}}" data-manager-refresh>{{.Format "Jan 2 15:04:05"}}</time>
                {{end}}
            </div>
        </div>
        <span class="status-pill {{$pillClass}}" data-manager-status-pill>
            <span class="dot" aria-hidden="true"></span>
            <span data-manager-status-text>{{$statusLabel}}</span>
            <span class="status-meta {{if or (not $statusMeta) $metaHidden}}hidden{{end}}" data-manager-status-meta>{{$statusMeta}}</span>
        </span>
    </div>
    <div class="card-body manager-card-body">
        <div class="manager-meta-grid" role="group" aria-label="Manager summary">
            <div class="manager-meta-block">
                <div class="meta-label">Servers Online</div>
                <div class="meta-value">
                    <span class="meta-strong" data-manager-servers-active>{{$serversActive}}</span>
                    <span class="meta-muted">/ {{$serversTotal}}</span>
                </div>
            </div>
            <div class="manager-meta-block">
                <div class="meta-label">Components Healthy</div>
                <div class="meta-value">
                    <span class="meta-strong" data-manager-components-ok>{{$componentsHealthy}}</span>
                    <span class="meta-muted">/ {{$componentsTotal}}</span>
                    {{if gt $componentsOutdated 0}}
                        <span class="meta-pill warning" data-manager-components-pending>{{$componentsOutdated}} pending</span>
                    {{end}}
                </div>
            </div>
            <div class="manager-meta-block">
                <div class="meta-label">Players Connected</div>
                <div class="meta-value">
                    <span class="meta-strong" data-manager-players>{{$playersConnected}}</span>
                </div>
            </div>
        </div>
        <div class="manager-info-grid text-sm">
            <div class="manager-info-field">
                <div class="text-tertiary text-xs uppercase tracking-wide">Web UI Port</div>
                <div class="info-value">
                    <span class="text-lg font-semibold" data-manager-port>{{$port}}</span>
                    {{if gt $portValue 0}}
                        <button type="button"
                                class="manager-copy-btn"
                                title="Copy port"
                                aria-label="Copy manager port"
                                data-card-nav-exempt="true"
                                data-copy-value="{{$portValue}}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            <span class="sr-only">Copy port</span>
                        </button>
                    {{end}}
                </div>
            </div>
            <div class="manager-info-field path-field">
                <div class="text-tertiary text-xs uppercase tracking-wide">Root Path</div>
                <div class="info-value">
                    <div class="font-mono break-words" data-manager-root>{{$root}}</div>
                    {{if $rootValue}}
                        <button type="button"
                                class="manager-copy-btn"
                                title="Copy root path"
                                aria-label="Copy SDSM root path"
                                data-card-nav-exempt="true"
                                data-copy-value="{{$rootValue}}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            <span class="sr-only">Copy root path</span>
                        </button>
                    {{end}}
                </div>
            </div>
        </div>
        <div class="manager-actions-toolbar" role="group" aria-label="Manager quick actions">
            <button type="button"
                class="btn btn-primary"
                data-card-nav-exempt="true"
                hx-post="/api/manager/update"
                hx-vals='{"update_all":"1"}'
                hx-target="this"
                hx-swap="none"
                hx-confirm="Start updates for all components now?"
                hx-disabled-elt="this">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7l-9 9-5-5"/><path d="M3 12a9 9 0 1 1 9 9"/></svg>
                <span>Run Updates</span>
            </button>
            <a class="btn btn-ghost"
               href="/logs/sdsm"
               target="_blank"
               rel="noopener noreferrer"
               data-card-nav-exempt="true">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 4h18"/><path d="M3 9h18"/><path d="M3 14h18"/><path d="M3 19h18"/></svg>
                <span>View Logs</span>
            </a>
            <button type="button"
                class="btn btn-secondary"
                data-card-nav-exempt="true"
                hx-post="/api/manager/update"
                hx-vals='{"restart":"1"}'
                hx-target="this"
                hx-swap="none"
                hx-confirm="Restart SDSM now?"
                hx-disabled-elt="this">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M1 14l5.37 5.37A9 9 0 0 0 20.49 15"/></svg>
                <span>Restart</span>
            </button>
            <button type="button"
                class="btn btn-danger"
                data-card-nav-exempt="true"
                hx-post="/api/manager/update"
                hx-vals='{"shutdown":"1"}'
                hx-target="this"
                hx-swap="none"
                hx-confirm="Stop SDSM and shut down all services?"
                hx-disabled-elt="this">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.364 5.636A9 9 0 1 1 5.636 18.364 9 9 0 0 1 18.364 5.636z"/><path d="M12 2v10"/></svg>
                <span>Stop SDSM</span>
            </button>
        </div>
    </div>
</div>
{{end}}
