{{define "cards/dashboard_server_tiles.html"}}
<div id="dashboard-card-server-tiles"
     class="card server-tiles-card"
     data-card-id="dashboard-server-tiles"
     data-server-tiles-card
     data-card-assets='["/static/js/cards/dashboard_server_tiles.js"]'
     hx-get="/dashboard/cards/dashboard-server-tiles"
     hx-trigger="sdsm:card-refresh[event.detail.cardId == 'dashboard-server-tiles'] from:body"
     hx-target="this"
     hx-swap="outerHTML">
    <div class="card-header">
        <h2 class="card-title">Server Tiles</h2>
        <div class="row gap-3 items-center flex-wrap">
            <div id="dashboard-server-tiles-indicator" class="text-tertiary text-sm hidden" role="status" aria-live="polite">
                Refreshingâ€¦
            </div>
            <button type="button"
                    class="btn btn-ghost btn-icon"
                    title="Refresh server tiles"
                    aria-label="Refresh server tiles"
                    data-card-refresh>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>
            </button>
            {{ if eq .role "admin" }}
            <button type="button"
                    class="btn btn-success"
                    hx-post="/api/servers/start-all"
                    hx-target="this"
                    hx-swap="none"
                    hx-disabled-elt="this"
                    hx-confirm="Start all stopped servers now?"
                    title="Start all stopped servers"
                    {{ if eq .startable 0 }}disabled aria-disabled="true"{{ end }}>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                <span>Start All Servers</span>
            </button>
            <button type="button"
                    class="btn btn-danger"
                    hx-post="/api/servers/stop-all"
                    hx-target="this"
                    hx-swap="none"
                    hx-disabled-elt="this"
                    hx-confirm="Stop all running servers now?"
                    title="Stop all running servers"
                    {{ if eq .active 0 }}disabled aria-disabled="true"{{ end }}>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2" ry="2"></rect></svg>
                <span>Stop All Servers</span>
            </button>
            <a href="/server/new" class="btn btn-primary" hx-get="/api/pages/server/new" hx-target="#content-area" hx-swap="innerHTML" hx-push-url="/server/new">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                <span>New Server</span>
            </a>
            {{ end }}
        </div>
    </div>
    <div class="card-body">
        <div id="server-grid"
             class="server-card-grid server-card-grid-halves"
             hx-get="/api/servers"
             hx-trigger="load, refresh from:body"
             hx-target="#server-grid"
             hx-swap="innerHTML"
             hx-indicator="#dashboard-server-tiles-indicator">
            {{ if .context }}
                {{ template "server_cards.html" .context }}
            {{ else }}
                {{ template "server_cards.html" (dict "servers" (slice) "role" .role) }}
            {{ end }}
        </div>
    </div>
</div>
{{end}}
