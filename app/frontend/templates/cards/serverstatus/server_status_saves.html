{{define "cards/server_status_saves.html"}}
<div class="card card-saves" id="saves-card"
    data-card-id="server-status-saves"
    data-card-lazy="true"
    data-player-saves="{{if .server.PlayerSaves}}true{{else}}false{{end}}"
    hx-get="/server/{{.server.ID}}/cards/server-status-saves"
    hx-trigger="sdsm:card-refresh[event.detail.cardId == 'server-status-saves'] from:body"
    hx-target="this"
    hx-swap="outerHTML">
    <div class="card-header card-header-with-actions">
        <div>
            <h2 class="card-title">Saves</h2>
            <p class="card-subtitle">Browse auto, quick, manual, and per-player snapshots.</p>
        </div>
        <div class="chip-row">
            <span class="chip chip-sm {{if .server.PlayerSaves}}chip-success{{else}}chip-muted{{end}}">
                <i data-feather="user-check"></i>
                Player Saves {{if .server.PlayerSaves}}Enabled{{else}}Disabled{{end}}
            </span>
            <span class="chip chip-sm chip-muted">
                <i data-feather="clock"></i>
                Every {{if gt .server.SaveInterval 0}}{{.server.SaveInterval}}s{{else}}default{{end}}
            </span>
        </div>
    </div>
    <div class="card-body saves-body">
        <div class="latest-save-summary" id="latest-save-summary">
            <div class="latest-save-details">
                <div class="latest-save-icon" aria-hidden="true">
                    <i data-feather="award"></i>
                </div>
                <div>
                    <p class="latest-save-label">Latest Save</p>
                    <p class="latest-save-name" id="latest-save-name">{{.server.Name}}.save</p>
                    <p class="latest-save-meta">
                        <span class="latest-save-path" id="latest-save-path">saves/{{.server.Name}}/{{.server.Name}}.save</span>
                        <span class="latest-save-time" id="latest-save-timestamp">
                            {{if .server.ServerSaved}}{{.server.ServerSaved.Format "Jan 2, 2006 3:04 PM"}}{{else}}Not saved yet{{end}}
                        </span>
                    </p>
                </div>
            </div>
            <div class="latest-save-actions">
                <button
                    type="button"
                    id="btn-load-latest-save"
                    class="btn btn-primary btn-sm btn-load-save"
                    data-save-filename="{{.server.Name}}.save"
                    data-save-type="manual"
                    data-save-label="{{.server.Name}}.save">
                    <i data-feather="download"></i>
                    Load Latest
                </button>
                <p class="latest-save-note">Stops the server, then loads this snapshot.</p>
            </div>
        </div>
        <div class="tabs" id="saves-tabs" role="tablist">
            <button class="tab active" role="tab" aria-selected="true" data-save-filter="all">All</button>
            <button class="tab" role="tab" aria-selected="false" data-save-filter="auto">Auto</button>
            <button class="tab" role="tab" aria-selected="false" data-save-filter="quick">Quick</button>
            <button class="tab" role="tab" aria-selected="false" data-save-filter="manual">Named</button>
            <button class="tab" role="tab" aria-selected="false" data-save-filter="player">Player</button>
        </div>
        <div class="saves-legend">
            <span><i data-feather="hard-drive"></i> Manager saves</span>
            <span><i data-feather="user"></i> Player-owned saves</span>
        </div>
        <div id="saves-list" class="saves-list" role="region" aria-live="polite"></div>
        <div id="saves-empty" class="saves-empty hidden">
            <div class="empty-state">
                <i data-feather="save"></i>
                <h3 class="empty-state-title">No saves found</h3>
                <p class="empty-state-description">Select a tab or trigger a save from the controls card.</p>
            </div>
        </div>
    </div>
</div>
{{end}}
