{{define "cards/server_status_chat.html"}}
{{$chatMessages := .server.Chat}}
<div class="card card-chat" id="chat-card"
    data-card-id="server-status-chat"
    hx-get="/server/{{.server.ID}}/cards/server-status-chat"
    hx-trigger="sdsm:card-refresh[event.detail.cardId == 'server-status-chat'] from:body"
    hx-target="this"
    hx-swap="outerHTML">
    <div class="card-header card-header-with-actions">
        <div>
            <h2 class="card-title">Chat</h2>
            <p class="card-subtitle">Live transcript pulled from server SAY events.</p>
        </div>
        <div class="chip-row">
            <span class="chip chip-sm {{if .server.Running}}chip-success{{else}}chip-muted{{end}}">
                <i data-feather="activity"></i>
                {{if .server.Running}}Live{{else}}Server Offline{{end}}
            </span>
            <span class="chip chip-sm chip-muted">
                <i data-feather="message-square"></i>
                {{len $chatMessages}} messages captured
            </span>
        </div>
    </div>
    <div class="card-body chat-body">
        <div class="chat-log" id="chat-log" aria-live="polite">
            {{if $chatMessages}}
                {{range $chatMessages}}
                    <article class="chat-message" data-timestamp="{{.Datetime.Format "2006-01-02T15:04:05Z07:00"}}">
                        <span class="chat-timestamp">{{.Datetime.Format "15:04"}}</span>
                        <span class="chat-author">{{if .Name}}{{.Name}}{{else}}Server{{end}}</span>
                        <span class="chat-text">{{.Message}}</span>
                    </article>
                {{end}}
            {{else}}
                <div id="chat-empty" class="empty-state">
                    <div class="empty-icon">
                        <i data-feather="message-square"></i>
                    </div>
                    <h3 class="empty-state-title">Chat is quiet</h3>
                    <p class="empty-state-description">Messages will appear here once the server starts broadcasting chat logs.</p>
                </div>
            {{end}}
        </div>
    </div>
    <div class="card-footer chat-footer">
        <form id="chat-form" class="chat-form" autocomplete="off">
            <label for="chat-input" class="sr-only">Send chat message</label>
            <input
                type="text"
                id="chat-input"
                class="form-control"
                placeholder="Say something to playersâ€¦"
                maxlength="240"
                {{if not .server.Running}}disabled{{end}}>
            <button type="submit" id="chat-send" class="btn btn-primary" {{if not .server.Running}}disabled{{end}}>
                <i data-feather="send"></i>
                Send
            </button>
        </form>
    </div>
</div>
{{end}}
