{{define "server_card.html"}}
{{$ctx := .}}
{{$server := .server}}
{{if not $server}}
    {{$server = .}}
{{end}}
{{$role := ""}}
{{if $ctx.role}}
    {{$role = $ctx.role}}
{{end}}
{{$isRunning := $server.IsRunning}}
{{$isStarting := $server.Starting}}
{{$isPaused := and $isRunning $server.Paused}}
{{$statusClass := "is-stopped"}}
{{$statusLabel := "Stopped"}}
{{if $isStarting}}
    {{$statusClass = "is-starting"}}
    {{$statusLabel = "Starting"}}
{{else if $isPaused}}
    {{$statusClass = "is-paused"}}
    {{$statusLabel = "Paused"}}
{{else if $isRunning}}
    {{$statusClass = "is-running"}}
    {{$statusLabel = "Running"}}
{{end}}

<div class="card server-card"
     data-server-id="{{$server.ID}}"
     data-target-url="/server/{{$server.ID}}">
    <div class="card-header">
        <div class="server-name" data-server-name>{{$server.Name}}</div>
        <div class="row gap-2">
            <span class="status-pill {{$statusClass}}" data-status aria-label="{{$statusLabel}}" title="{{$statusLabel}}"></span>
            <span class="status-pill {{if $server.Storming}}is-storm{{else}}is-clear{{end}}"
                  data-storm
                  {{if not (and $isRunning $server.Storming)}}style="display:none;"{{end}}></span>
        </div>
    </div>

    <div class="card-content">
        {{if $server.LastError}}
        <div class="alert alert-danger alert-compact" data-stop-navigation="true">
            <div class="alert-title">Startup Error</div>
            <div class="alert-message">{{$server.LastError}}</div>
        </div>
        {{end}}

        <div class="server-info">
            <div class="info-inline-row">
                <div class="info-label">World</div>
                <div class="info-value world" data-world-value>{{if $server.World}}{{$server.World}}{{else}}Unknown{{end}}</div>
            </div>
            <div class="info-inline-row">
                <div class="info-label">Players</div>
                <div class="info-value" data-player-count>{{$server.ClientCount}} / {{$server.MaxClients}}</div>
            </div>
            <div class="info-inline-row">
                <div class="info-label">Port</div>
                <div class="info-value" data-port-value>{{if gt $server.Port 0}}{{$server.Port}}{{else}}â€”{{end}}</div>
            </div>
            <div class="info-inline-row">
                <div class="info-label">Password</div>
                <div class="info-value">{{if $server.Password}}Enabled{{else}}Disabled{{end}}</div>
            </div>
        </div>
    </div>

    <div class="card-footer" data-stop-navigation="true">
        <div class="btn-group">
            {{if $isRunning}}
                <button class="btn btn-sm btn-danger"
                        hx-post="/api/servers/{{$server.ID}}/stop"
                        hx-confirm="Are you sure you want to stop this server?"
                        hx-target="closest .server-card"
                        hx-swap="outerHTML">
                    {{template "icon_stop" .}} Stop
                </button>
            {{else}}
                <button class="btn btn-sm btn-success"
                        hx-post="/api/servers/{{$server.ID}}/start"
                        hx-target="closest .server-card"
                        hx-swap="outerHTML">
                    {{template "icon_play" .}} Start
                </button>
            {{end}}
            {{if eq $role "admin"}}
            <button type="button"
                    class="btn btn-sm btn-secondary"
                    data-action="rename-server"
                    data-server-id="{{$server.ID}}"
                    data-server-name="{{$server.Name}}"
                    data-stop-navigation="true">
                {{template "icon_edit" .}} Rename
            </button>
            {{end}}
            <a href="/server/{{$server.ID}}"
               class="btn btn-sm btn-secondary"
               hx-get="/server/{{$server.ID}}"
               hx-push-url="/server/{{$server.ID}}">
                Manage {{template "icon_arrow_right" .}}
            </a>
        </div>
    </div>
</div>
{{end}}
