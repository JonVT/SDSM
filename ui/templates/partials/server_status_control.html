<div class="card card-control">
    <div class="card-header">
        <h2 class="card-title">Server Control</h2>
        <span class="status-pill {{if .server.Running}}status-running{{else}}status-idle{{end}}" id="status-pill-container">
            <span id="status-dot-indicator" class="dot {{if .server.Running}}running{{end}}"></span>
            <span id="status-dot-text">{{if .server.Running}}Running{{else}}Stopped{{end}}</span>
        </span>
    </div>
    <form method="POST">
        <div class="control-section">
            <div class="control-row">
                <label>Server:</label>
                <div class="button-group">
                    <button type="submit" name="start" value="true" class="btn btn-control btn-success" id="btn-start" title="Start the server" {{if .server.Running}}style="display:none;" disabled aria-disabled="true"{{end}}>
                        <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        Start
                    </button>
                    <button type="submit" name="stop" value="true" class="btn btn-control btn-danger" id="btn-stop" title="Stop the server" {{if not .server.Running}}style="display:none;" disabled aria-disabled="true"{{end}}>
                        <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <rect x="6" y="6" width="12" height="12" rx="2"/>
                        </svg>
                        Stop
                    </button>
                    <button type="submit" name="restart" value="true" class="btn btn-control btn-secondary" id="btn-restart" title="Restart the server process">
                        <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                            <path d="M21 3v5h-5"/>
                        </svg>
                        Restart
                    </button>
                    <button type="button" class="btn btn-control" id="btn-pause" title="Pause or resume the world" {{if not .server.Running}}disabled aria-disabled="true"{{end}}>{{if .server.Paused}}Resume{{else}}Pause{{end}}</button>
                    <button type="button" class="btn btn-control" id="btn-save" title="Save world to disk" {{if not .server.Running}}disabled aria-disabled="true"{{end}}>
                        <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        Save
                    </button>
                    <span class="control-sep" aria-hidden="true">â€¢</span>
                    {{/* Storm control moved inline with server controls */}}
                    {{if .server.Running}}
                    <button type="button" class="btn btn-control btn-storm" id="btn-storm" title="Start a storm event">
                        <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" title="Storm">
                            <path d="M19 16.9A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 3 15"/>
                            <polyline points="13 11 9 17 15 17 11 23"/>
                        </svg>
                        Storm Start
                    </button>
                    {{else}}
                    <button type="button" class="btn btn-control btn-storm" id="btn-storm" title="Start a storm event" disabled aria-disabled="true">
                        <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" title="Storm">
                            <path d="M19 16.9A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 3 15"/>
                            <polyline points="13 11 9 17 15 17 11 23"/>
                        </svg>
                        Storm Start
                    </button>
                    {{end}}
                </div>
            </div>
            <div class="status-info">
                <div class="status-row">
                    <span class="status-label">Started:</span>
                    <span id="server-started-value">{{if .server.ServerStarted}}{{.server.ServerStarted.Format "01/02/2006 15:04:05"}}{{else}}Not started{{end}}</span>
                </div>
                <div class="status-row">
                    <span class="status-label">Last Saved:</span>
                    <span id="server-saved-value">{{if .server.ServerSaved}}{{.server.ServerSaved.Format "01/02/2006 15:04:05"}}{{else}}Not saved{{end}}</span>
                </div>
            </div>
                <div class="log-preview">
                <div id="last-log-line" class="log-line">{{if .server.LastLogLine}}{{.server.LastLogLine}}{{else}}No log data{{end}}</div>
                <button type="button" class="btn btn-secondary btn-min-sm" title="Open the server log" onclick="openLogPopup({{.server.ID}})">
                    <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    View Log
                </button>
            </div>
            <div class="control-row" style="margin-top: var(--space-3); padding-top: var(--space-3); border-top: 1px solid var(--border-color); justify-content: space-between;">
                <!-- More/Less toggle left-justified on the card, inline with buttons -->
                <button type="button" id="control-more-toggle" class="card-more-link" aria-expanded="false" title="Show advanced actions">
                    <svg class="icon-inline" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                    <span style="margin-left:6px;">More</span>
                </button>
                <div class="control-actions" style="width:auto; margin-left:auto;">
                    <div class="button-group">
                        <div id="server-update-progress" class="update-progress compact" aria-live="polite">
                            <div class="update-progress-bar">
                                <div class="update-progress-fill"></div>
                            </div>
                            <div class="update-progress-text">Idle</div>
                        </div>
                        <button type="submit" name="update_server" value="true" class="btn btn-primary" title="Download and install the latest server files" {{if or .server.Running .server.Starting}}disabled aria-disabled="true"{{end}}>
                            <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                                <path d="M21 3v5h-5"/>
                            </svg>
                            Update Server
                        </button>
                    <button type="submit" name="delete" value="true" id="btn-delete" class="btn btn-danger" title="Delete this server and its files" {{if or .server.Running .server.Starting}}disabled aria-disabled="true"{{end}} onclick="return confirm('Are you sure you want to delete this server? This action cannot be undone.')">
                            <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
                                <path d="M10 11v6"/>
                                <path d="M14 11v6"/>
                            </svg>
                            Delete Server
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expandable More section placeholder -->
        <div class="card-more-section" id="server-more-section" aria-hidden="true">
            <div class="control-section">
                <div class="control-row">
                    <label title="Cleans up player bodies">Cleanup Players</label>
                    <div class="control-actions">
                        <div class="button-group">
                            <button type="button" class="btn btn-control" id="btn-cleanup-dead" title="Cleans up player bodies">Dead</button>
                            <button type="button" class="btn btn-control" id="btn-cleanup-disconnected" title="Cleans up player bodies">Disconnected</button>
                            <button type="button" class="btn btn-control" id="btn-cleanup-all" title="Cleans up player bodies">All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer removed: More/Less toggle moved inline with Update Server button -->
    </form>
</div>
