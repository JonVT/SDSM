{{define "manager_discord_card"}}
<div class="glass-card discord-card">
    <div class="card-header">
        <div>
            <h2 class="card-title">Discord Integration</h2>
            <p class="card-subtitle">Send manager and server events to Discord with rich, tokenized embeds.</p>
        </div>
        <a class="btn btn-ghost" href="/help/tokens" hx-get="/api/pages/help/tokens" hx-push-url="/help/tokens" hx-target="#content-area" hx-swap="innerHTML">
            <i data-feather="info"></i>
            <span>Token Reference</span>
        </a>
    </div>
    <div class="card-body flex flex-col gap-6">
        <section class="discord-section">
            <div class="section-heading">
                <h3>Webhooks</h3>
                <p>Manager events can post to their own webhook, while server notifications use a default that each server may override.</p>
            </div>
            <div class="webhook-grid">
                <div class="form-group">
                    <label for="discord_manager_webhook" class="form-label">Manager Webhook</label>
                    <input type="text" id="discord_manager_webhook" name="discord_manager_webhook" value="{{ .discord_manager_webhook }}" form="manager-settings-form" placeholder="https://discord.com/api/webhooks/..." class="form-control">
                    <p class="help-text">Used for deploy + manager alerts. Falls back to the default webhook when empty.</p>
                </div>
                <div class="form-group">
                    <label for="discord_default_webhook" class="form-label">Default Server Webhook</label>
                    <input type="text" id="discord_default_webhook" name="discord_default_webhook" value="{{ .discord_default_webhook }}" form="manager-settings-form" placeholder="https://discord.com/api/webhooks/..." class="form-control">
                    <p class="help-text">Servers inherit this webhook unless a custom one is configured per-server.</p>
                </div>
            </div>
        </section>

        <details class="discord-collapse" data-collapse-id="discord-manager-events">
            <summary class="discord-collapse-summary">
                <div>
                    <h3>Manager Events</h3>
                    <p>Control deploy notifications and which components trigger them.</p>
                </div>
                <div class="summary-indicator">
                    <span class="summary-status">{{ if .notify_enable_deploy }}Enabled{{ else }}Disabled{{ end }}</span>
                    <span class="summary-icon" data-collapse-icon>
                        <i data-feather="chevron-down" aria-hidden="true"></i>
                    </span>
                </div>
            </summary>
            <div class="discord-collapse-body">
                <label class="toggle-field">
                    <input type="checkbox" id="notify_enable_deploy" name="notify_enable_deploy" form="manager-settings-form" class="form-checkbox" {{ if .notify_enable_deploy }}checked{{ end }}>
                    <span>Send manager notifications</span>
                </label>
                <div class="component-toggle-grid">
                <label class="toggle-field">
                    <input type="checkbox" name="notify_deploy_release" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_release }}checked{{ end }}>
                    <span>Release</span>
                </label>
                <label class="toggle-field">
                    <input type="checkbox" name="notify_deploy_beta" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_beta }}checked{{ end }}>
                    <span>Beta</span>
                </label>
                <label class="toggle-field">
                    <input type="checkbox" name="notify_deploy_bepinex" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_bepinex }}checked{{ end }}>
                    <span>BepInEx</span>
                </label>
                <label class="toggle-field">
                    <input type="checkbox" name="notify_deploy_launchpad" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_launchpad }}checked{{ end }}>
                    <span>LaunchPad</span>
                </label>
                <label class="toggle-field">
                    <input type="checkbox" name="notify_deploy_scon" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_scon }}checked{{ end }}>
                    <span>SCON</span>
                </label>
                <label class="toggle-field">
                    <input type="checkbox" name="notify_deploy_steamcmd" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_steamcmd }}checked{{ end }}>
                    <span>SteamCMD</span>
                </label>
                <label class="toggle-field">
                    <input type="checkbox" name="notify_deploy_servers" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_servers }}checked{{ end }}>
                    <span>Servers</span>
                </label>
            </div>
                <div class="notification-grid" aria-label="Manager notification templates">
                    <div class="notification-row stacked" role="group" aria-labelledby="manager-event-start">
                        <span class="notification-label" id="manager-event-start">Deploy Started</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_deploy_on_started" name="notify_deploy_on_started" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_on_started }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_deploy_started" name="notify_msg_deploy_started" form="manager-settings-form" rows="2" class="form-control" placeholder="Deployment started: {{`{{component}}`}}">{{ .notify_msg_deploy_started }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_deploy_started" name="notify_color_deploy_started" form="manager-settings-form" value="{{ .notify_color_deploy_started }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                    <div class="notification-row stacked" role="group" aria-labelledby="manager-event-complete">
                        <span class="notification-label" id="manager-event-complete">Deploy Completed</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_deploy_on_completed" name="notify_deploy_on_completed" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_on_completed }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_deploy_completed" name="notify_msg_deploy_completed" form="manager-settings-form" rows="2" class="form-control" placeholder="Deployment completed: {{`{{component}}`}}">{{ .notify_msg_deploy_completed }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_deploy_completed" name="notify_color_deploy_completed" form="manager-settings-form" value="{{ .notify_color_deploy_completed }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                    <div class="notification-row stacked" role="group" aria-labelledby="manager-event-error">
                        <span class="notification-label" id="manager-event-error">Deploy Error</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_deploy_on_completed_error" name="notify_deploy_on_completed_error" form="manager-settings-form" class="form-checkbox" {{ if .notify_deploy_on_completed_error }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_deploy_completed_error" name="notify_msg_deploy_completed_error" form="manager-settings-form" rows="2" class="form-control" placeholder="Deployment completed with errors: {{`{{component}}`}}">{{ .notify_msg_deploy_completed_error }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_deploy_completed_error" name="notify_color_deploy_completed_error" form="manager-settings-form" value="{{ .notify_color_deploy_completed_error }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </details>

        <details class="discord-collapse" data-collapse-id="discord-server-events">
            <summary class="discord-collapse-summary">
                <div>
                    <h3>Default Server Events</h3>
                    <p>Events each server inherits unless overridden per-server. <button type="button" class="inline-link" data-token-popup="server-defaults" data-token-title="Server Token Reference" data-token-intro="Click a token to copy it to your clipboard.">Tokens</button> are supported.</p>
                </div>
                <div class="summary-indicator">
                    <span class="summary-status">{{ if .notify_enable_server }}Enabled{{ else }}Disabled{{ end }}</span>
                    <span class="summary-icon" data-collapse-icon>
                        <i data-feather="chevron-down" aria-hidden="true"></i>
                    </span>
                </div>
            </summary>
            <div class="discord-collapse-body">
                <label class="toggle-field">
                    <input type="checkbox" id="notify_enable_server" name="notify_enable_server" form="manager-settings-form" class="form-checkbox" {{ if .notify_enable_server }}checked{{ end }}>
                    <span>Enable server defaults</span>
                </label>
                <div class="notification-grid" aria-label="Server notification templates">
                    <div class="notification-row stacked" role="group" aria-labelledby="server-event-started">
                        <span class="notification-label" id="server-event-started">Server Started</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_on_start" name="notify_on_start" form="manager-settings-form" class="form-checkbox" {{ if .notify_on_start }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_start" name="notify_msg_start" form="manager-settings-form" rows="2" class="form-control" placeholder="Server {{`{{server_name}}`}} started">{{ .notify_msg_start }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_start" name="notify_color_start" form="manager-settings-form" value="{{ .notify_color_start }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                    <div class="notification-row stacked" role="group" aria-labelledby="server-event-stopping">
                        <span class="notification-label" id="server-event-stopping">Stopping</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_on_stopping" name="notify_on_stopping" form="manager-settings-form" class="form-checkbox" {{ if .notify_on_stopping }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_stopping" name="notify_msg_stopping" form="manager-settings-form" rows="2" class="form-control" placeholder="Server {{`{{server_name}}`}} stopping">{{ .notify_msg_stopping }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_stopping" name="notify_color_stopping" form="manager-settings-form" value="{{ .notify_color_stopping }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                    <div class="notification-row stacked" role="group" aria-labelledby="server-event-stopped">
                        <span class="notification-label" id="server-event-stopped">Stopped</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_on_stopped" name="notify_on_stopped" form="manager-settings-form" class="form-checkbox" {{ if .notify_on_stopped }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_stopped" name="notify_msg_stopped" form="manager-settings-form" rows="2" class="form-control" placeholder="Server {{`{{server_name}}`}} stopped">{{ .notify_msg_stopped }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_stopped" name="notify_color_stopped" form="manager-settings-form" value="{{ .notify_color_stopped }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                    <div class="notification-row stacked" role="group" aria-labelledby="server-event-restart">
                        <span class="notification-label" id="server-event-restart">Restart</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_on_restart" name="notify_on_restart" form="manager-settings-form" class="form-checkbox" {{ if .notify_on_restart }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_restart" name="notify_msg_restart" form="manager-settings-form" rows="2" class="form-control" placeholder="Server {{`{{server_name}}`}} restart">{{ .notify_msg_restart }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_restart" name="notify_color_restart" form="manager-settings-form" value="{{ .notify_color_restart }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                    <div class="notification-row stacked" role="group" aria-labelledby="server-event-update-started">
                        <span class="notification-label" id="server-event-update-started">Update Started</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_on_update_started" name="notify_on_update_started" form="manager-settings-form" class="form-checkbox" {{ if .notify_on_update_started }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_update_started" name="notify_msg_update_started" form="manager-settings-form" rows="2" class="form-control" placeholder="{{`{{server_name}}`}} update started">{{ .notify_msg_update_started }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_update_started" name="notify_color_update_started" form="manager-settings-form" value="{{ .notify_color_update_started }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                    <div class="notification-row stacked" role="group" aria-labelledby="server-event-update-completed">
                        <span class="notification-label" id="server-event-update-completed">Update Completed</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_on_update_completed" name="notify_on_update_completed" form="manager-settings-form" class="form-checkbox" {{ if .notify_on_update_completed }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_update_completed" name="notify_msg_update_completed" form="manager-settings-form" rows="2" class="form-control" placeholder="{{`{{server_name}}`}} update completed">{{ .notify_msg_update_completed }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_update_completed" name="notify_color_update_completed" form="manager-settings-form" value="{{ .notify_color_update_completed }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                    <div class="notification-row stacked" role="group" aria-labelledby="server-event-update-failed">
                        <span class="notification-label" id="server-event-update-failed">Update Failed</span>
                        <div class="notification-fields">
                            <label class="field-group enabled-field">
                                <span class="field-title">Enabled</span>
                                <input type="checkbox" id="notify_on_update_failed" name="notify_on_update_failed" form="manager-settings-form" class="form-checkbox" {{ if .notify_on_update_failed }}checked{{ end }}>
                            </label>
                            <label class="field-group message-field">
                                <span class="field-title">Message</span>
                                <textarea id="notify_msg_update_failed" name="notify_msg_update_failed" form="manager-settings-form" rows="2" class="form-control" placeholder="{{`{{server_name}}`}} update failed">{{ .notify_msg_update_failed }}</textarea>
                            </label>
                            <label class="field-group color-field">
                                <span class="field-title">Color</span>
                                <input type="color" id="notify_color_update_failed" name="notify_color_update_failed" form="manager-settings-form" value="{{ .notify_color_update_failed }}" class="color-picker">
                            </label>
                        </div>
                    </div>
                </div>
        </details>
    </div>
</div>
{{end}}
