{{define "manager_configuration_card"}}
<div class="glass-card manager-config-card">
    <div class="card-header">
        <div>
            <h2 class="card-title">Configuration</h2>
            <p class="card-subtitle">Tune how SDSM runs, updates, and secures access.</p>
        </div>
    </div>
    <form id="manager-settings-form" hx-post="/update" hx-target="#manager-settings-form" hx-swap="outerHTML" class="config-form flex flex-col gap-4">
        <div class="form-group">
            <label for="steam_id">Steam ID</label>
            <input type="text" id="steam_id" name="steam_id" value="{{ .steam_id }}" class="form-control">
        </div>
        <div class="form-group">
            <label for="root_path">Root Path</label>
            <div class="flex wrap gap-2">
                <input type="text" id="root_path" name="root_path" value="{{ .root_path }}" class="form-control flex-grow-input" placeholder="/srv/sdsm">
                <button type="button" class="btn btn-neutral" data-path-picker="root_path" data-picker-label="Root Path" data-picker-placeholder="/srv/sdsm" data-picker-mode="directory">
                    <i data-feather="folder"></i>
                    <span>Select Path</span>
                </button>
            </div>
        </div>
        <div class="form-group">
            <label for="port">Web UI Port</label>
            <input type="number" id="port" name="port" value="{{ .port }}" class="form-control">
        </div>
        <div class="form-group top-align">
            <label for="auto_port_forward_manager">Port Forward (UPnP)</label>
            <div class="field-inline items-start gap-2">
                <input type="checkbox" id="auto_port_forward_manager" name="auto_port_forward_manager" {{ if .auto_port_forward_manager }}checked{{ end }} class="form-checkbox">
                <span class="text-secondary text-sm" aria-live="polite">Attempt UPnP/NAT-PMP port forwarding for the manager UI port. <strong>Only enable this if you know what you're doing.</strong></span>
            </div>
        </div>
        <div class="form-group">
            <label for="auto_update_time">Auto Update Time</label>
            <div class="flex wrap gap-2">
                <input type="time" id="auto_update_time" name="auto_update" value="{{ .auto_update_time }}" step="60" class="form-control flex-grow-input">
                <button type="button" class="btn btn-neutral" data-show-picker="auto_update_time" aria-label="Open time picker">
                    <i data-feather="clock"></i>
                    <span>Pick Time</span>
                </button>
            </div>
        </div>
        <div class="form-group top-align">
            <label for="start_update">Update at Startup</label>
            <div class="field-inline items-start gap-2">
                <input type="checkbox" id="start_update" name="start_update" {{ if .start_update }}checked{{ end }} class="form-checkbox">
                <span class="text-secondary text-sm" aria-live="polite">Automatically check and apply updates whenever SDSM launches.</span>
            </div>
        </div>
        <div class="form-group top-align">
            <label for="detached_servers">Detached Servers</label>
            <div class="field-inline items-start gap-2">
                <input type="checkbox" id="detached_servers" name="detached_servers" {{ if .detached }}checked{{ end }} class="form-checkbox">
                <span class="text-secondary text-sm" aria-live="polite">Keep Stationeers servers running if the manager process is closed.</span>
            </div>
        </div>
        <div class="form-group top-align">
            <label for="tray_enabled">Windows Tray Icon</label>
            <div class="field-inline items-start gap-2">
                <input type="checkbox" id="tray_enabled" name="tray_enabled" {{ if .tray_enabled }}checked{{ end }} class="form-checkbox">
                <span class="text-secondary text-sm" aria-live="polite">Adds a background-friendly tray icon on Windows hosts.</span>
            </div>
        </div>
        <div class="form-group top-align">
            <label for="tls_enabled">HTTPS (TLS)</label>
            <div class="field-inline items-start gap-2">
                <input type="checkbox" id="tls_enabled" name="tls_enabled" {{ if .tls_enabled }}checked{{ end }} class="form-checkbox">
                <span class="text-secondary text-sm" aria-live="polite">Serve the web UI over HTTPS using the certificate assets below (restart required).</span>
            </div>
        </div>
        <div class="form-group">
            <label>Certificates</label>
            <div class="flex wrap gap-2">
                <button type="button" class="btn btn-secondary" hx-post="/update" hx-vals='{"generate_tls_self_signed": "1"}' hx-target="#manager-settings-form" hx-swap="outerHTML" data-requires-tls="true" {{ if not .tls_enabled }}disabled{{ end }}>
                    <i data-feather="shield"></i>
                    <span>Generate Cert</span>
                </button>
                <p class="text-secondary text-sm">Creates a self-signed certificate pair for quick HTTPS testing.</p>
            </div>
        </div>
        <div class="form-group top-align">
            <label for="tls_cert">TLS Source Paths</label>
            <div class="flex flex-col gap-3">
                <div class="flex flex-col gap-1">
                    <span class="text-secondary text-xs uppercase tracking-wide">Certificate Source</span>
                    <div class="flex wrap gap-2">
                        <input type="text" id="tls_cert" name="tls_cert" value="{{ .tls_cert }}" class="form-control flex-grow-input" placeholder="/path/to/cert.pem" data-requires-tls="true" {{ if not .tls_enabled }}disabled{{ end }}>
                        <button type="button" class="btn btn-neutral" data-path-picker="tls_cert" data-picker-label="Certificate Source" data-picker-placeholder="/path/to/cert.pem" data-picker-mode="file" data-requires-tls="true" {{ if not .tls_enabled }}disabled{{ end }}>
                            <i data-feather="folder"></i>
                            <span>Select Path</span>
                        </button>
                    </div>
                </div>
                <div class="flex flex-col gap-1">
                    <span class="text-secondary text-xs uppercase tracking-wide">Private Key Source</span>
                    <div class="flex wrap gap-2">
                        <input type="text" id="tls_key" name="tls_key" value="{{ .tls_key }}" class="form-control flex-grow-input" placeholder="/path/to/key.pem" data-requires-tls="true" {{ if not .tls_enabled }}disabled{{ end }}>
                        <button type="button" class="btn btn-neutral" data-path-picker="tls_key" data-picker-label="Private Key Source" data-picker-placeholder="/path/to/key.pem" data-picker-mode="file" data-requires-tls="true" {{ if not .tls_enabled }}disabled{{ end }}>
                            <i data-feather="folder"></i>
                            <span>Select Path</span>
                        </button>
                    </div>
                </div>
                <p class="text-secondary text-xs">Sources are copied into <code>certs/</code> as <code>sdsm.crt</code> / <code>sdsm.key</code>. Files must be valid PEM.</p>
            </div>
        </div>
        <div class="form-group form-row-full">
            <button type="submit" name="update_config" value="1" class="btn btn-primary">
                <i data-feather="save"></i>
                <span>Update Config</span>
            </button>
        </div>
    </form>
    <p class="text-secondary text-sm">NOTE: Changes may restart SDSM so updates to TLS and ports can take effect.</p>
</div>
{{end}}
