{{define "title"}}Manager Settings{{end}}
{{define "page"}}manager{{end}}

{{define "manager.html"}}
<div data-page-title="Manager Settings" class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- Left Column -->
    <div class="lg:col-span-2 flex flex-col gap-6">
        <form id="manager-settings-form" hx-post="/update" hx-target="#manager-settings-form" hx-swap="outerHTML" class="card">
            <div class="card-header">
                <h2 class="card-title">Manager Settings</h2>
            </div>
            <div class="card-body grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                    <label for="root_path" class="form-label">Root Path</label>
                    <input type="text" id="root_path" name="root_path" value="{{ .root_path }}" class="form-control">
                </div>
                <div class="form-group">
                    <label for="steam_id" class="form-label">Steam ID</label>
                    <input type="text" id="steam_id" name="steam_id" value="{{ .steam_id }}" class="form-control">
                </div>
                <div class="form-group">
                    <label for="port" class="form-label">Web UI Port</label>
                    <input type="number" id="port" name="port" value="{{ .port }}" class="form-control">
                </div>
                 <div class="form-group">
                    <label for="auto_update_time" class="form-label">Auto Update Time</label>
                    <input type="time" id="auto_update_time" name="auto_update" value="{{ .auto_update_time }}" step="60" class="form-control">
                </div>
                <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <label class="form-group-tile items-center">
                        <input type="checkbox" id="start_update" name="start_update" {{ if .start_update }}checked{{ end }} class="form-switch">
                        <span>Update at Startup</span>
                    </label>
                    <label class="form-group-tile items-center">
                        <input type="checkbox" id="detached_servers" name="detached_servers" {{ if .detached }}checked{{ end }} class="form-switch">
                        <span>Detached Servers</span>
                    </label>
                    <label class="form-group-tile items-center">
                        <input type="checkbox" id="tray_enabled" name="tray_enabled" {{ if .tray_enabled }}checked{{ end }} class="form-switch">
                        <span>Windows Tray Icon</span>
                    </label>
                </div>
            </div>
            <div class="card-footer">
                <button type="submit" name="update_config" value="1" class="btn btn-primary">
                    <i data-feather="save"></i>
                    <span>Save All Settings</span>
                </button>
            </div>
        </form>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Discord Integration</h2>
                 <a class="btn btn-ghost" href="/tokens" hx-get="/tokens" hx-push-url="/tokens" hx-target="#content-area" hx-swap="innerHTML">
                    <i data-feather="info"></i>
                    <span>Token Reference</span>
                </a>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="discord_default_webhook" class="form-label">Default Discord Webhook</label>
                    <input type="text" id="discord_default_webhook" name="discord_default_webhook" value="{{ .discord_default_webhook }}" form="manager-settings-form" placeholder="https://discord.com/api/webhooks/..." class="form-control">
                     <p class="help-text">Templates support tokens like {{`{{server_name}}`}}, {{`{{event}}`}}, etc.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column -->
    <div class="flex flex-col gap-6">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Connectivity</h2>
            </div>
            <div class="card-body grid gap-4">
                <div class="form-group">
                    <label for="tls_cert" class="form-label">TLS Cert Path</label>
                    <input type="text" id="tls_cert" name="tls_cert" value="{{ .tls_cert }}" class="form-control" form="manager-settings-form">
                </div>
                <div class="form-group">
                    <label for="tls_key" class="form-label">TLS Key Path</label>
                    <input type="text" id="tls_key" name="tls_key" value="{{ .tls_key }}" class="form-control" form="manager-settings-form">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <label class="form-group-tile items-center">
                        <input type="checkbox" id="auto_port_forward_manager" name="auto_port_forward_manager" {{ if .auto_port_forward_manager }}checked{{ end }} class="form-switch" form="manager-settings-form">
                        <span>Port Forward (UPnP)</span>
                    </label>
                    <label class="form-group-tile items-center">
                        <input type="checkbox" id="tls_enabled" name="tls_enabled" {{ if .tls_enabled }}checked{{ end }} class="form-switch" form="manager-settings-form">
                        <span>HTTPS (TLS)</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">HTTPS Status</label>
                    <div>
                        {{- if not .tls_enabled -}}
                            <span class="badge badge-warn">Disabled</span>
                        {{- else if and (ne .tls_cert "") (ne .tls_key "") -}}
                            <span class="badge badge-success">Configured</span>
                        {{- else -}}
                            <span class="badge badge-danger">Missing Certificate or Key</span>
                        {{- end }}
                    </div>
                </div>
                 <div class="form-group">
                    <label class="form-label">Generate Self-Signed Cert</label>
                    <button type="button" class="btn btn-secondary" hx-post="/update" hx-vals='{"generate_tls_self_signed": "1"}' hx-target="#manager-settings-form" hx-swap="outerHTML">
                        <i data-feather="shield"></i>
                        <span>Generate</span>
                    </button>
                    <p class="help-text">For quick HTTPS testing. Not for production.</p>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Manager Control</h2>
            </div>
            <div class="card-body flex flex-wrap gap-4">
                <button class="btn btn-danger" hx-post="/update" hx-vals='{"shutdown": "1"}' hx-confirm="Are you sure you want to shut down the manager?">
                    <i data-feather="power"></i>
                    <span>Shutdown Manager</span>
                </button>
                <button class="btn btn-secondary" hx-post="/update" hx-vals='{"restart": "1"}' hx-confirm="Are you sure you want to restart the manager?">
                    <i data-feather="refresh-cw"></i>
                    <span>Restart Manager</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Full Width Below -->
    <div class="card lg:col-span-3">
        <div class="card-header">
            <h2 class="card-title">Version Status</h2>
            <button class="btn btn-ghost" hx-get="/api/manager/versions" hx-target="#version-status-grid" hx-swap="innerHTML">
                <i data-feather="refresh-cw"></i>
                <span>Refresh</span>
            </button>
        </div>
        <div id="version-status-grid" class="card-body" hx-get="/api/manager/versions" hx-trigger="load" hx-swap="innerHTML">
            <!-- Version info will be loaded here -->
        </div>
    </div>
</div>
{{end}}