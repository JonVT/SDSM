{{ define "commands.html" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Console Commands - SDSM</title>
    <link rel="stylesheet" href="/static/ui-theme.css">
    <script>
        (function(){
            var t = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', t);
        })();
    </script>
    <style>
        :root { --cmd-surface: var(--bg-primary); --cmd-border: var(--border-color); }
        body { background: var(--page-background); color: var(--text-secondary); font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .container { max-width:1400px; margin: 0 auto; padding: var(--space-7) var(--space-6); }
        .hero-card { display:flex; align-items:center; justify-content:space-between; gap: var(--space-6); padding: var(--space-5); background: var(--bg-primary); border:1px solid var(--panel-border); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); }
        .hero-main { display:flex; align-items:center; gap: var(--space-4); }
        .hero-logo { border-radius: 12px; }
        .hero-heading { display:flex; flex-direction:column; }
        .hero-title { font-size: var(--text-2xl); font-weight: 700; color: var(--text-primary); }
        .hero-subtitle { font-size: var(--text-sm); color: var(--text-tertiary); }
        .hero-actions { display:flex; align-items:center; gap: var(--space-3); }
        .commands-search { min-width:280px; padding:10px 14px; border:1px solid var(--input-border); background: var(--input-surface); color: var(--text-primary); border-radius:8px; font-size:14px; }
        .commands-search:focus { outline:none; border-color: var(--primary-600); box-shadow: 0 0 0 2px rgba(37,99,235,.25); }
        .filter-info { font-size:12px; color: var(--text-tertiary); margin:16px 2px 8px; }
        .table-shell { border:1px solid var(--cmd-border); border-radius:12px; overflow:hidden; background: var(--cmd-surface); box-shadow: var(--shadow-sm); }
        .commands-table { width:100%; border-collapse:separate; border-spacing:0; table-layout:fixed; font-size:13px; }
        .commands-table thead th { position:sticky; top:0; background: linear-gradient(120deg, var(--cmd-surface), #222b37); color: var(--text-primary); font-weight:600; text-align:left; padding:10px 12px; border-bottom:1px solid var(--cmd-border); font-size:12px; letter-spacing:.05em; text-transform:uppercase; }
        .commands-table tbody td { vertical-align:top; padding:10px 12px; border-bottom:1px solid var(--cmd-border); color: var(--text-secondary); word-break:break-word; }
        .commands-table tbody tr:last-child td { border-bottom:none; }
        .commands-table tbody tr { transition: background .15s ease; }
        .commands-table tbody tr:hover { background: rgba(99,102,241,0.08); }
        .cmd-name { font-family:monospace; font-weight:600; font-size:12px; background: var(--bg-secondary); display:inline-block; padding:4px 8px; border-radius:6px; color: var(--text-primary); box-shadow: inset 0 0 0 1px var(--cmd-border); cursor:pointer; }
        .cmd-name:focus { outline: 2px solid var(--primary-500); outline-offset:2px; }
        .usage-badge { display:inline-block; background: var(--chip-bg); color: var(--chip-text); padding:3px 8px; border-radius:6px; font-size:11px; margin:3px 5px 5px 0; font-family:monospace; box-shadow: inset 0 0 0 1px var(--cmd-border); }
        .empty-usage { color: var(--text-tertiary); font-style:italic; }
        .description-block { white-space:pre-line; line-height:1.4; font-size:12.5px; max-height:4.5em; overflow:hidden; position:relative; }
        .description-block.expanded { max-height:none; }
        .desc-toggle { display:inline-block; margin-top:6px; font-size:12px; color: var(--primary-500); cursor:pointer; }
        .highlight { background: var(--primary-600); color:#fff; }
        .az-bar { margin-top:16px; display:flex; flex-wrap:wrap; gap:6px; font-size:11px; letter-spacing:.05em; }
        /* Make Aâ€“Z navigation buttons much smaller */
        .az-bar .btn { font-size:11px; padding:0 !important; width:22px; min-width:22px; height:22px; min-height:22px; line-height:22px; border-radius:4px; text-align:center; display:inline-flex; align-items:center; justify-content:center; }
        .az-bar .btn svg { width:14px; height:14px; }
        .commands-table col.name { width:160px; }
        .commands-table col.usage { width:260px; }
        @media (max-width: 1100px) { .commands-table col.usage { width:200px; } }
        @media (max-width: 900px) { .commands-table col.usage { display:none; } }
    </style>
</head>
<body class="page-shell">
    <div class="container">
        <header class="hero-card">
            <div class="hero-main">
                <img src="/sdsm.png" alt="SDSM" width="56" height="56" class="hero-logo" />
                <div class="hero-heading">
                    <h1 class="hero-title">Console Commands</h1>
                    <p class="hero-subtitle">Reference of available server console commands.</p>
                </div>
            </div>
            <div class="hero-actions">
                <input id="cmd-search" class="commands-search" type="text" placeholder="Filter commands (name, usage, description)..." autocomplete="off">
            </div>
        </header>

        <div class="az-bar">
            {{ range .letters }}
                <a href="#cmd-{{.}}" class="btn btn-control">{{.}}</a>
            {{ end }}
        </div>

        <p class="filter-info">Loaded {{ len .commands }} commands. Click a command name to copy it.</p>

        <div class="table-shell">
            <table class="commands-table" id="commands-table">
                <colgroup>
                    <col class="name">
                    <col class="usage">
                    <col>
                </colgroup>
                <thead>
                    <tr>
                        <th>Command</th>
                        <th>Usage / Args</th> 
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {{ range .commands }}
                    <tr {{ if .Anchor }}id="{{ .Anchor }}"{{ end }} data-name="{{ .Name }}" data-usage="{{ .UsageStr }}" data-desc="{{ .Description }}">
                        <td class="cmd-name" title="Click to copy command" tabindex="0">{{ .Name }}</td>
                        <td>
                            {{ if .Usages }}
                                {{ range .Usages }}<span class="usage-badge">{{ . }}</span>{{ end }}
                            {{ else }}<span class="empty-usage">(none)</span>{{ end }}
                        </td>
                        <td>
                            <div class="description-block">{{ .Description }}</div>
                            <a href="#" class="desc-toggle hidden">Show more</a>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
    </div>

    <script>
    (function(){
        const search = document.getElementById('cmd-search');
        const rows = Array.from(document.querySelectorAll('#commands-table tbody tr'));
        function normalize(s){ return (s||'').toLowerCase(); }
        function filter(){
            const q = normalize(search.value.trim());
            rows.forEach(r => {
                if(!q){ r.style.display=''; return; }
                const hay = (r.dataset.name + ' ' + r.dataset.usage + ' ' + r.dataset.desc).toLowerCase();
                r.style.display = hay.indexOf(q) !== -1 ? '' : 'none';
            });
        }
        // Prefilter via ?q= param
        const params = new URLSearchParams(window.location.search);
        const initialQ = params.get('q');
        if(initialQ){ search.value = initialQ; }
        search.addEventListener('input', filter);
        filter();

        rows.forEach(r => {
            const nameCell = r.querySelector('.cmd-name');
            const desc = r.querySelector('.description-block');
            const toggle = r.querySelector('.desc-toggle');
            if(desc && toggle){
                requestAnimationFrame(() => {
                    if(desc.scrollHeight > desc.clientHeight + 4){ toggle.classList.remove('hidden'); }
                });
                toggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    const expanded = desc.classList.toggle('expanded');
                    toggle.textContent = expanded ? 'Show less' : 'Show more';
                });
            }
            if(nameCell){
                function copyText(text){
                    if (navigator.clipboard && window.isSecureContext) {
                        return navigator.clipboard.writeText(text);
                    }
                    return new Promise((resolve, reject) => {
                        try {
                            const ta = document.createElement('textarea');
                            ta.value = text;
                            ta.style.position = 'fixed';
                            ta.style.left = '-1000px';
                            ta.style.top = '-1000px';
                            document.body.appendChild(ta);
                            ta.focus();
                            ta.select();
                            const ok = document.execCommand('copy');
                            document.body.removeChild(ta);
                            ok ? resolve() : reject(new Error('copy failed'));
                        } catch(e) { reject(e); }
                    });
                }
                nameCell.addEventListener('click', () => {
                    const cmd = nameCell.textContent.trim();
                    copyText(cmd).then(() => {
                        nameCell.classList.add('highlight');
                        setTimeout(()=> nameCell.classList.remove('highlight'), 800);
                    }).catch(() => {});
                });
                nameCell.addEventListener('keydown', e => { if(e.key==='Enter'){ nameCell.click(); }});
            }
        });
    })();
    </script>
</body>
</html>
{{ end }}
{{/* Ensure modal partials are available when this template is rendered standalone */}}
{{ template "modal_templates" . }}
{{ template "modal_scripts" . }}
